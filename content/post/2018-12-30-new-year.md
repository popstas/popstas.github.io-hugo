+++
title = "Итоги 2018 года"
date = "2019-03-17T15:50:00+06:00"
slug = "new-year-2018"
image = "/images/2018-12/new-year.jpg"
tags = ["offtop", "итоги года"]
+++

Этот пост должен был выйти в конце года, но я про него забыл, лучше поздно, чем никогда )


![ёлочный шар]({{< param image >}})
<!--more-->

## Технические итоги

### Ansible
Ansible больше не вдохновляет, теперь он просто работает, и это радует )

В этом году добавил несколько ролей: drupal-console, redis, letsencrypt-acmesh.

На Ubuntu 18.04 не обновлялся, только на dev-серверах.

В конфиг сайта начали добавлять метаинформацию: название сайта, категорию, примерную посещаемость и т.д., эта инфа доступна в таблице сайтов (ниже)


### Хостинг
Тут тоже всё спокойно. В прошлом году мы весь год переезжали, избавлялись от привязанности к хостингу, централизации и т.д.
В этом году мы полностью переехали под гипервизоры и отказались от Vscale, теперь мы платим за 2 выделенных сервера, а получаем 6 мощных виртуалок, еще запас остается под пару дополнительных. Переезд сайтов с сервера на сервер на однотипных серверах делается вообще без сюрпризов, но рутины много, на сервер с 20-40 сайтами уходит полдня минимум, мы два сервера за день перевезли.

В этом году на одном из наших сайтов была долгая DDoS атака, которая шла около 2 недель. После отбивания скриптами в течение пары дней, с переменным успехом (злоумышленник периодически обходил поставленную защиту, сайт падал, пока я не напишу новую), я попробовал защиту Qrator, она практически свела к нулю флуд, поступающий на сервер, а скрипты добивали остальное. Cloudflare тоже пробовал, он помогал слабо, именно на той атаке (на других я видел, как он работает хорошо).


### Мониторинг
Мониторинг вещей вроде того, что место на диске кончается, или на сервере много запросов, не работает с весны, но мы и без него почти не пропускаем проблемы:

- каждый сервер мониторится раз в 5 минут через UptimeRobot (по одному сайту на сервер)
- каждый сайт проверяется на работоспособность раз в час (помогает найти, например, просроченные домены)
- раз в 2 недели мы просматриваем все графики за последний месяц, чтобы увидеть глобальные проблемы

Также я наладил сбор метрик с каждого нашего сайта раз в 3 часа, метрики получаются путем выполнения команды в корне сайта, всего их около 70. Метрики собираются в один большой json, который используется другими внутренними проектами. Один из них, например, использует список, чтобы проверить на код 200, другой - чтобы скачать сайт на машину программиста, третий выводит все метрики в виде таблицы с валидацией значений (плохое подсвечивается красным), фильтрами, сортировкой, языком запросов. По таблице удобно оценивать какой-то показатель в разрезе всех сайтов, можно найти некоторые проблемы (например, 10 тегов h1 на сайте).


### HTTPS
HTTPS пришел, мы больше не делаем сайты без HTTPS.

Написал роль [ansible-role-letsencrypt-acmesh](https://github.com/viasite-ansible/ansible-role-letsencrypt-acmesh), она интегрирована с нашей ролью site, мы просто указываем в конфиге `ssl: yes` и если домен находится на нашем Selectel DNS аккаунте, сертификат выпускается автоматически, даже если сайт еще не в инете, даже wildcard сертификаты. Это почти всегда работает, а когда ломается, письма от letsencrypt не дают забыть (один раз все-таки забыл).


### Drupal
Drupal 8 мы не осилили. Целый месяц мы ковыряли движок в 2.5 человека, переписывали свои фичи и модули с 7-ки, адаптировались к новому набору модулей, искали аналоги. В итоге мы пришли к тому, что нам слишком многого не хватает в 8-ке, ни одного сайта мы на ней не сделали.


### Языки
В этом году я определенно много писал на javascript. JS, PHP, Go, Python


### Микроконтроллеры
Ничего не делал, так, цеплял пару датчиков к ESP8266, в том году было намного больше.


### Операционки
В мае вышла новая Ubuntu 18.04, и я не мог не попробовать переехать на нее, подробности [тут](/blog/2018/04/30/windows-ubuntu-18.04-migrate/). Если в двух словах, не смог побороть несколько глюков, так бы остался. К июню вернулся на винду и никуда не ходил.


### Github
Начал писать здесь и решил вынести в отдельную статью - [Мой Github 2018](/blog/2018/12/30/my-github-2018/).

---



## Про жизнь



### Жилье
Навел порядок на балконе, это не так-то просто, неделю только я разбирал вещи, потом красил подоконник, утеплял пол.

Почти через 2 года после покупки панелей обшил ими туалет (они мешали на балконе), но до конца доделать влом, может на третий год сделаю.

Осенью на меня вообще что-то нашло, и я несколько недель прибирался, прибрал буквально всё, раз в пару лет полезно такое делать.


### Музыка
Новые группы: Аффинаж, Casual, ДМЦ, Амели на мели, Коридор, Проект ХБ, Коля Маню.

Аффинаж ваще крутой, по музыке ничего подобного не слышал: баян, труба, бас, гитара - все инструменты равнозначны, все музыканты крутые.

Подсел на Яндекс.Музыку, только на неделе хвалил их [в посте](https://vk.com/wall4288271_1831), а они после этого еще и подкасты запустили )

В январе сыграл первую песню на пианино, на 4 аккордах, но почти без запинок. Но пианино не цепляет, за год наверное песен 10 сыграл, так научиться играть не получится.

Открыл гениально простую вещь: каподастр связан с транспонированием, раньше я не мог играть песни на одних баррэ, теперь многое играть проще.

Заказал комбик на батарейках и микрофон к нему, чтобы играть без привязки к компу. Через месяц надоело, но штука полезная: громкая колонка на батарейках на 10 часов.

Купил походно-офисную гитару, она в 2 раза тоньше. Позже она из офисной стала кухонной.

[Мой плейлист с mp3](https://vk.com/audios4288271?section=playlists&z=audio_playlist4288271_1).



### Кино
В начале года импортировал фильмы из Имхонета, теперь Кинопоиск - мой основной гид по фильмам.
В этом году были периоды безудержного смотрения фильмов, до 20 в неделю доходило кажется )

Понравились фильмы:
- Король говорит (про английского герцога)
- Лето (про Цоя и Науменко
- Антон Серебренников)
- Аннигиляция (про другую жизнь)
- Зои (про синтов)
- Песнь моря (скандинавская сказка)
- Про любовь (истории про отношения)
- Закат цивилизации (про захват Земли)

Лучшее: Песнь моря.



### Гаджеты, железо
- потерял свой крутой Xiaomi Mi 6, купил вместо него два Xiaomi попроще, Pocophone хороший
- перестал пользоваться часами как экранчик для просмотра уведомлений (не по своей воле), стало хуже
- обновил сервер, теперь он потребляет 25 ватт вместо 100+, через 10 лет окуплю электричество
- купил еще парочку bluetooth наушников, идеал до сих пор не найден, для улицы использую QCY50, для спорта клон Nokia BH-503
- [купил 3d принтер](/blog/2018/11/07/3d-printed-expandable-tea-box/), немного ошибся с размерами, но в целом доволен
- взял колонку Irbis со встроенной Алисой, это лучше, чем на телефоне или Windows, не зря взял, я не понимал как это, хотя до этого 2 месяца навык писал



### Походы
- катался на лыжах на Губахе, Мраткино, Банном, Абзаково
- летом был на Чусовой
- в сентябре был на Усьвинских столбах

Карта моих походов:

{{< imglazy src="/images/2018-12/my-map-2018.jpg" >}}


### Концерты
В этом году я сходил на Аффинаж, через несколько месяцев слушания.



### В этом году я в первый раз:
- сделал патч для популярного Drupal модуля (features)



### В этом году я больше, чем в прошлые годы:
- катался на горных лыжах
- писал на javascript
- писал свой opensource



### Что стало хуже
- все меньше велика и лыж (в новом сезоне возвращаю лыжи)
- велотренажер не использовал полгода